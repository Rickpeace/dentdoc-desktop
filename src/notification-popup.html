<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>DentDoc</title>
  <link rel="stylesheet" href="styles/design-system.css">
  <style>
    body {
      background: transparent;
      overflow: hidden;
      padding: 6px;
      min-height: auto;
    }

    body::before {
      display: none;
    }

    .container {
      background: var(--overlay-bg, rgba(10, 10, 11, 0.95));
      backdrop-filter: blur(40px);
      -webkit-backdrop-filter: blur(40px);
      border-radius: var(--radius-xl);
      padding: var(--space-5) var(--space-6);
      border: 1px solid var(--overlay-border, rgba(255, 255, 255, 0.1));
      position: relative;
      box-shadow: none;
      width: 360px;
      cursor: pointer;
      transition: all var(--transition-fast);
      overflow: hidden;
    }

    .container:hover {
      border-color: var(--primary-500);
      transform: translateY(-2px);
    }

    [data-theme="light"] .container {
      --overlay-bg: rgba(255, 255, 255, 0.95);
      --overlay-border: rgba(0, 0, 0, 0.1);
    }

    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
    }

    [data-theme="light"] .container::before {
      background: linear-gradient(90deg, transparent, rgba(249, 115, 22, 0.2), transparent);
    }

    .header {
      display: flex;
      align-items: center;
      gap: var(--space-4);
    }

    .icon {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .icon svg {
      width: 24px;
      height: 24px;
      stroke: white;
      stroke-width: 2.5;
      fill: none;
    }

    .icon.warning {
      background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
    }

    .icon.error {
      background: linear-gradient(135deg, var(--error-500), var(--error-600));
    }

    .icon.success {
      background: linear-gradient(135deg, var(--success-500), var(--success-600));
    }

    .icon.info {
      background: linear-gradient(135deg, var(--info-500), var(--info-600));
    }

    .content {
      flex: 1;
      min-width: 0;
    }

    .title {
      color: var(--text-primary);
      font-size: 0.9375rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .message {
      color: var(--text-secondary);
      font-size: 0.8125rem;
      line-height: 1.4;
    }

    .close-btn {
      background: rgba(255, 255, 255, 0.08);
      border: none;
      color: var(--text-tertiary);
      width: 32px;
      height: 32px;
      border-radius: var(--radius-md);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
      flex-shrink: 0;
      position: absolute;
      top: 12px;
      right: 12px;
    }

    .close-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      color: var(--text-primary);
    }

    [data-theme="light"] .close-btn {
      background: rgba(0, 0, 0, 0.05);
    }

    [data-theme="light"] .close-btn:hover {
      background: rgba(0, 0, 0, 0.1);
    }

    .cta-hint {
      font-size: 0.6875rem;
      color: var(--primary-500);
      margin-top: var(--space-3);
      display: flex;
      align-items: center;
      gap: var(--space-1);
    }

    .cta-hint svg {
      width: 12px;
      height: 12px;
    }

    /* Auto-close progress bar */
    .auto-close-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: rgba(255, 255, 255, 0.1);
    }

    .auto-close-fill {
      height: 100%;
      background: var(--primary-500);
      width: 100%;
      animation: shrink 8s linear forwards;
    }

    @keyframes shrink {
      from { width: 100%; }
      to { width: 0%; }
    }
  </style>
</head>
<body>
  <script>
    // Load theme immediately to prevent flash
    const { ipcRenderer: themeRenderer } = require('electron');
    themeRenderer.invoke('get-theme').then(theme => {
      document.documentElement.setAttribute('data-theme', theme || 'dark');
    });
  </script>
  <div class="container" id="container">
    <button id="closeBtn" class="close-btn">
      <svg width="12" height="12" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M1 1l12 12M13 1L1 13"/>
      </svg>
    </button>
    <div class="header">
      <div id="icon" class="icon warning">
        <svg id="iconSvg" viewBox="0 0 24 24">
          <path d="M12 9v4M12 17h.01M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/>
        </svg>
      </div>
      <div class="content">
        <div id="title" class="title">Hinweis</div>
        <div id="message" class="message">Nachricht hier</div>
        <div id="ctaHint" class="cta-hint" style="display: none;">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
          <span>Klicken f√ºr mehr Infos</span>
        </div>
      </div>
    </div>
    <div class="auto-close-bar">
      <div id="autoCloseFill" class="auto-close-fill"></div>
    </div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');

    const container = document.getElementById('container');
    const icon = document.getElementById('icon');
    const iconSvg = document.getElementById('iconSvg');
    const title = document.getElementById('title');
    const message = document.getElementById('message');
    const closeBtn = document.getElementById('closeBtn');
    const ctaHint = document.getElementById('ctaHint');
    const autoCloseFill = document.getElementById('autoCloseFill');

    let hasClickAction = false;
    let autoCloseTimeout = null;

    // Listen for notification data
    ipcRenderer.on('show-notification', (event, data) => {
      title.textContent = data.title || 'DentDoc';
      message.textContent = data.body || '';

      // Set icon type
      const type = data.type || 'warning';
      icon.className = 'icon ' + type;

      // Set SVG icon based on type
      switch (type) {
        case 'error':
          // X icon
          iconSvg.innerHTML = '<path d="M18 6L6 18M6 6l12 12"/>';
          break;
        case 'success':
          // Checkmark icon
          iconSvg.innerHTML = '<path d="M20 6L9 17l-5-5"/>';
          break;
        case 'info':
          // Info icon (circle with i)
          iconSvg.innerHTML = '<circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/>';
          break;
        case 'warning':
        default:
          // Warning triangle
          iconSvg.innerHTML = '<path d="M12 9v4M12 17h.01M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/>';
          break;
      }

      // Show CTA hint if there's a click action
      hasClickAction = data.hasClickAction || false;
      ctaHint.style.display = hasClickAction ? 'flex' : 'none';

      // Auto-close after 8 seconds
      if (autoCloseTimeout) clearTimeout(autoCloseTimeout);
      autoCloseTimeout = setTimeout(() => {
        ipcRenderer.send('close-notification-popup');
      }, 8000);

      // Reset animation
      autoCloseFill.style.animation = 'none';
      autoCloseFill.offsetHeight; // Trigger reflow
      autoCloseFill.style.animation = 'shrink 8s linear forwards';
    });

    // Click on container triggers action
    container.addEventListener('click', (e) => {
      if (e.target === closeBtn || closeBtn.contains(e.target)) return;
      if (hasClickAction) {
        ipcRenderer.send('notification-popup-clicked');
      }
      ipcRenderer.send('close-notification-popup');
    });

    // Close button
    closeBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      ipcRenderer.send('close-notification-popup');
    });
  </script>
</body>
</html>
